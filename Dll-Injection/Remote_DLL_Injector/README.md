# Remote DLL Injector

## About 
Have implemented a Remote DLL Injector based on PID. We can first enumerate the available processes on the system and find the pid to any given associated process name. And based on this pid we are now able to inject into it any dll we want. 

## Technique

The technique involves just writing the name of the DLL that we intend to load onto the virtual memory space of the target process, and then call a LoadLibrary reading in the string at this allocated buffer.

This can be accomplished in these steps :  

- [Process Enumeration](https://github.com/retr0ds/Malware-learning/tree/main/Process_Enumeration) - We enumerate all the processes to find out the pid of the target process 
- [OpenProcess](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess) is used to get the handle of the target process based on the pid we obtained from enumeration
- Then we use [GetFullPathNameW](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfullpathnamew) to get the full path of the DLL (which is present in the same directory as the Injector.) 
- [VirtualAllocEx](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex) is used and not VirtualAlloc because the former allows for Remote Process Memory Allocation. We use the appropriate PAGE_READWRITE Access, and then allocate memory space in the Target Process.
- [WriteProcessMemory](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory) is used to allow us to write to Remote Process Memory. We pass the pointer to the allocated memory space and the buffer it needs to take the memory from.
- [GetModuleHandle](https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) is used to retrieve the handle of a module aka DLL that's already been loaded into memory. In this case we get the handle to the _kernel32.dll_ which contains the Function/Procedure called _LoadLibraryW_ 
- [GetProcModule](https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) This is used to get the address of a exported function. In our case, [_LoadlibraryW_](https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibraryw). We can use this returned address, as a function pointer and just call the function(). However, we need more than that if we are to run this function in the memory space of another function.
-  [CreateRemoteThread](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) is used to Start and Run a thread in a remote memory space with a given address as the starting point. It also allows us to pass parametrs, in our case it is our DLL_Name (example : "Jonathan_Blaze.dll").


## NOTE

The DLL injection works only once per PID, because we can't load the same dll into a process twice.