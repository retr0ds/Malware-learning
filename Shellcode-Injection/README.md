# About

This features code for a tool "Shellcode Injector" which does remote Shellcode Injection given the PID of the target process. And to get the PID of a process, we can first enumerate all available processes' names and PIDs.

## Technique 

The technique involves decrypting a encrypted shellcode (to avoid static analysis) and then loading this said decrypted shellcode into the Virtual Memory space of the target process. Then we can CreateRemoteThread onto the starting point of the allocated memory space to just straight up run the shellcode

## Payload

The payload I have chosen for this explanation is a simple "pop a calculator", which as the name suggests just launcher a calculator. 

The assembly code for this shellcode can be found        : [here](https://github.com/retr0ds/Malware-learning/tree/main/shellcode/pop_calculator) <br>
The explanation behind the code's working can be found   : [here](https://retr0ds.github.io/posts/shellcoding_series/series1_pop_a_calc_part_1/)


## Steps

This can be accomplished in the following steps : 


- [Process Enumeration](https://github.com/retr0ds/Malware-learning/tree/main/Process_Enumeration) - We enumerate all the processes to find out the pid of our desired target process 
- Once PID is selected, then we enter _Inject_Shellcode_ function. Wherein we first xor the payload(launchin calculator shellcode) with xor and then replace it back in the same array/pointer 
- [OpenProcess](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess) is used to get the handle of the target process based on the pid we obtained from enumeration 
- [VirtualAllocEx](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex) is used and not VirtualAlloc because the former allows for Remote Process Memory Allocation. We use the appropriate PAGE_READWRITE Access, and then allocate memory space in the Target Process to load our shellcode/payload.
- [WriteProcessMemory](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory) is used to allow us to write to Remote Process Memory, meaning, we can write to the memory of another process. We pass the pointer of the allocated memory space and the buffer it needs to take the memory from.
- [CreateRemoteThread](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) is used to Start and Run a thread in a remote memory space with a given address as the starting point. 

